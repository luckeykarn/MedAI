<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedAi - Symptom Checker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.18/dist/css/bootstrap-select.min.css">
    <style>
        .symptom-tag {
            display: inline-block;
            background: #e3f2fd;
            border-radius: 20px;
            padding: 5px 12px;
            margin: 3px;
            font-size: 0.85rem;
        }
        .symptom-tag .remove-tag {
            cursor: pointer;
            margin-left: 5px;
        }
        .result-card {
            transition: all 0.3s ease;
            border-left: 4px solid;
        }
        .result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .probability-bar {
            height: 10px;
            border-radius: 5px;
        }
        .chat-container {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 10px;
        }
        .user-message {
            background: #e3f2fd;
            border-radius: 15px 15px 0 15px;
        }
        .bot-message {
            background: #f8f9fa;
            border-radius: 15px 15px 15px 0;
        }
    </style>
</head>
<body>
    <!-- Navbar (same as diseases.html) -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <!-- ... same navbar content ... -->
    </nav>

    <!-- Main Content -->
    <div class="container my-5">
        <div class="row">
            <div class="col-lg-8">
                <div class="card shadow mb-4">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="fas fa-stethoscope me-2"></i> Symptom Checker</h4>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <h5 class="mb-3">1. Select Your Symptoms</h5>
                            <select class="selectpicker form-control" multiple data-live-search="true" 
                                    title="Choose symptoms..." data-actions-box="true" id="symptomSelector">
                                <option>Fever</option>
                                <option>Headache</option>
                                <option>Cough</option>
                                <option>Fatigue</option>
                                <option>Nausea</option>
                                <option>Dizziness</option>
                                <option>Chest pain</option>
                                <option>Shortness of breath</option>
                                <option>Sore throat</option>
                                <option>Runny nose</option>
                                <option>Muscle aches</option>
                                <option>Abdominal pain</option>
                                <option>Diarrhea</option>
                                <option>Vomiting</option>
                                <option>Rash</option>
                            </select>
                            <div class="mt-2" id="selectedSymptoms">
                                <!-- Selected symptoms will appear here -->
                            </div>
                        </div>

                        <div class="mb-4">
                            <h5 class="mb-3">2. Provide Additional Details</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Duration of Symptoms</label>
                                    <select class="form-select" id="symptomDuration">
                                        <option value="">Select duration</option>
                                        <option>Less than 24 hours</option>
                                        <option>1-3 days</option>
                                        <option>4-7 days</option>
                                        <option>1-2 weeks</option>
                                        <option>More than 2 weeks</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Severity</label>
                                    <select class="form-select" id="symptomSeverity">
                                        <option value="">Select severity</option>
                                        <option>Mild (doesn't interfere with daily activities)</option>
                                        <option>Moderate (some interference)</option>
                                        <option>Severe (prevents normal activities)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Other Relevant Information</label>
                                <textarea class="form-control" rows="3" 
                                          placeholder="E.g., recent travel, known exposures, existing conditions"></textarea>
                            </div>
                        </div>

                        <div class="d-grid">
                            <button class="btn btn-primary btn-lg" id="analyzeBtn">
                                <i class="fas fa-brain me-2"></i> Analyze Symptoms
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="card shadow" id="resultsSection" style="display: none;">
                    <div class="card-header bg-white">
                        <h4 class="mb-0"><i class="fas fa-diagnoses me-2 text-primary"></i> Possible Conditions</h4>
                    </div>
                    <div class="card-body" id="conditionResults">
                        <!-- Results will be loaded here -->
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <!-- AI Chat Assistant -->
                <div class="card shadow mb-4">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="fas fa-robot me-2"></i> MedAi Assistant</h4>
                    </div>
                    <div class="card-body">
                        <div class="chat-container p-3 mb-3" id="chatContainer">
                            <div class="d-flex mb-3 justify-content-start">
                                <div class="bot-message p-3">
                                    <strong>MedAi:</strong> Hello! I can help you understand your symptoms. 
                                    Describe how you're feeling or use the symptom checker on the left.
                                </div>
                            </div>
                        </div>
                        <div class="input-group">
                            <input type="text" class="form-control" id="chatInput" 
                                   placeholder="Type your message...">
                            <button class="btn btn-primary" id="sendChatBtn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Symptom Information -->
                <div class="card shadow">
                    <div class="card-header bg-white">
                        <h4 class="mb-0"><i class="fas fa-info-circle me-2 text-info"></i> About Symptom Checking</h4>
                    </div>
                    <div class="card-body">
                        <p>Our symptom checker uses artificial intelligence to analyze your symptoms and suggest possible conditions.</p>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Important:</strong> This tool is not a substitute for professional medical advice. Always consult a doctor for serious symptoms.
                        </div>
                        <h5 class="mt-3">When to Seek Immediate Care:</h5>
                        <ul class="small">
                            <li>Chest pain or pressure</li>
                            <li>Difficulty breathing</li>
                            <li>Severe abdominal pain</li>
                            <li>Sudden dizziness or confusion</li>
                            <li>Severe headache</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.18/dist/js/bootstrap-select.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize select picker
            $('.selectpicker').selectpicker();
            
            // Track selected symptoms
            $('#symptomSelector').on('changed.bs.select', function() {
                const selected = $(this).val() || [];
                $('#selectedSymptoms').html(
                    selected.map(symptom => `
                        <span class="symptom-tag">
                            ${symptom}
                            <span class="remove-tag" data-symptom="${symptom}">&times;</span>
                        </span>
                    `).join('')
                );
                
                // Add click handlers for remove buttons
                $('.remove-tag').click(function() {
                    const symptomToRemove = $(this).data('symptom');
                    const currentValues = $('#symptomSelector').val() || [];
                    const newValues = currentValues.filter(val => val !== symptomToRemove);
                    $('#symptomSelector').selectpicker('val', newValues);
                    $('#selectedSymptoms').html(
                        newValues.map(symptom => `
                            <span class="symptom-tag">
                                ${symptom}
                                <span class="remove-tag" data-symptom="${symptom}">&times;</span>
                            </span>
                        `).join('')
                    );
                });
            });
            
            // Analyze symptoms button
            $('#analyzeBtn').click(function() {
                const symptoms = $('#symptomSelector').val() || [];
                const duration = $('#symptomDuration').val();
                const severity = $('#symptomSeverity').val();
                
                if (symptoms.length === 0) {
                    alert('Please select at least one symptom');
                    return;
                }
                
                // Show loading state
                $(this).html('<i class="fas fa-spinner fa-spin me-2"></i> Analyzing...');
                
                // Simulate API call (in real app, this would call your backend)
                setTimeout(() => {
                    // Mock results
                    const mockResults = [
                        { 
                            condition: "Influenza (Flu)", 
                            probability: 0.75,
                            description: "Viral infection with fever, cough, body aches",
                            severity: "Moderate",
                            action: "Rest, fluids, consider antiviral medication if early in illness"
                        },
                        { 
                            condition: "Common Cold", 
                            probability: 0.65,
                            description: "Milder respiratory symptoms without high fever",
                            severity: "Mild",
                            action: "Rest, fluids, over-the-counter symptom relief"
                        },
                        { 
                            condition: "COVID-19", 
                            probability: 0.45,
                            description: "Possible coronavirus infection",
                            severity: "Varies",
                            action: "Consider testing, isolate if suspected"
                        }
                    ];
                    
                    displayResults(mockResults);
                    $('#resultsSection').show();
                    $(this).html('<i class="fas fa-brain me-2"></i> Analyze Symptoms');
                    
                    // Scroll to results
                    $('html, body').animate({
                        scrollTop: $('#resultsSection').offset().top - 20
                    }, 500);
                }, 1500);
            });
            
            function displayResults(results) {
                const resultsContainer = $('#conditionResults');
                resultsContainer.html('');
                
                results.sort((a, b) => b.probability - a.probability);
                
                results.forEach(result => {
                    const card = $(`
                        <div class="card result-card mb-3 border-left-${getSeverityColor(result.probability)}">
                            <div class="card-body">
                                <div class="d-flex justify-content-between mb-2">
                                    <h5>${result.condition}</h5>
                                    <span class="badge bg-${getSeverityColor(result.probability)}">
                                        ${Math.round(result.probability * 100)}% Match
                                    </span>
                                </div>
                                <p class="text-muted small">${result.description}</p>
                                <div class="mb-2">
                                    <div class="probability-bar bg-${getSeverityColor(result.probability, true)}" 
                                         style="width: ${result.probability * 100}%"></div>
                                </div>
                                <div class="alert alert-${getSeverityColor(result.probability, true)} small">
                                    <strong><i class="fas fa-first-aid me-1"></i> Recommended:</strong> ${result.action}
                                </div>
                                <button class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-book-medical me-1"></i> Learn More
                                </button>
                            </div>
                        </div>
                    `);
                    resultsContainer.append(card);
                });
            }
            
            function getSeverityColor(probability, isLight = false) {
                if (probability > 0.7) return isLight ? 'danger' : 'danger';
                if (probability > 0.4) return isLight ? 'warning' : 'warning';
                return isLight ? 'info' : 'info';
            }
            
            // Chat functionality
            $('#sendChatBtn').click(sendChatMessage);
            $('#chatInput').keypress(function(e) {
                if (e.which === 13) sendChatMessage();
            });
            
            function sendChatMessage() {
                const message = $('#chatInput').val().trim();
                if (message) {
                    addChatMessage('user', message);
                    $('#chatInput').val('');
                    
                    // Simulate AI response
                    setTimeout(() => {
                        const responses = [
                            "I understand you're experiencing symptoms. Can you describe them in more detail?",
                            "Based on what you're saying, it might be helpful to check your temperature.",
                            "Have you considered using our symptom checker tool for a more detailed analysis?",
                            "That sounds concerning. How long have you had these symptoms?",
                            "I recommend speaking with a healthcare provider about this."
                        ];
                        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                        addChatMessage('bot', randomResponse);
                    }, 1000);
                }
            }
            
            function addChatMessage(sender, message) {
                const chatContainer = $('#chatContainer');
                const messageClass = sender === 'user' ? 'user-message' : 'bot-message';
                const senderName = sender === 'user' ? 'You' : 'MedAi';
                
                chatContainer.append(`
                    <div class="d-flex mb-3 justify-content-${sender === 'user' ? 'end' : 'start'}">
                        <div class="${messageClass} p-3">
                            <strong>${senderName}:</strong> ${message}
                        </div>
                    </div>
                `);
                
                chatContainer.scrollTop(chatContainer[0].scrollHeight);
            }
        });
    </script>
</body>
</html>